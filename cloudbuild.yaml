steps:
- name: 'gcr.io/cloud-builders/docker'
  id: Build
  args:
  - 'build'
  - '--build-arg'
  - 'version=$SHORT_SHA'
  - '-t'
  - 'europe-docker.pkg.dev/dft-rsss-findtransptdata-dev/dft-nap/prototypes:$SHORT_SHA'
  - '.'
  - '--progress=plain'
  - '--no-cache'

- name: 'gcr.io/cloud-builders/docker'
  id: Push
  args:
  - 'push'
  - 'europe-docker.pkg.dev/dft-rsss-findtransptdata-dev/dft-nap/prototypes:$SHORT_SHA'


# This step only applies the managed cert in dev
#- name: 'gcr.io/cloud-builders/git'
#  id: Managed cert
#  entrypoint: 'bash'
#  args:
#  - '-c'
#  - |
#    sed -i "s#_DOMAINNAME#${_DOMAINNAME}#g" manifests/managed-cert.yaml



#- name: "gcr.io/cloud-builders/gke-deploy"
#  args:
#  - run
#  - --filename=manifests/
#  - --location=europe-west1
#  - --namespace=${_NAMESPACE}
#  - --cluster=${PROJECT_ID}-cluster
#  timeout: 600s

#substitutions:
#    _NAMESPACE: dft-nap-dev
